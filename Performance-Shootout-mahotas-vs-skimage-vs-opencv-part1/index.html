<!DOCTYPE html>
<html>
  <head>
    <title>Performance shootout - python libraries for computer vision (Part 1/2) – Lernen durch Codierung</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Did a little performance comparison for different image processing/computer vision libraries for simple morphological operations" />
    <meta property="og:description" content="Did a little performance comparison for different image processing/computer vision libraries for simple morphological operations" />
    
    <meta name="author" content="kampta" />

    
    <meta property="og:title" content="Performance shootout - python libraries for computer vision (Part 1/2)" />
    <meta property="twitter:title" content="Performance shootout - python libraries for computer vision (Part 1/2)" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="kampta - Lernen durch Codierung" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://www.gravatar.com/avatar/a3fe98194076676cf4674a06e63c56ad.jpg" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">kampta</a></h1>
            <p class="site-description">Lernen durch Codierung</p>
          </div>

          <nav>
            <a href="/research">Research</a>
            <a href="/blog">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Performance shootout - python libraries for computer vision (Part 1/2)</h1>

  <div class="entry">
    <p><strong>Update 2017-02-03</strong></p>

<p>Updated to latest versions of opencv/mahotas/skimage</p>

<hr />

<p>What are the fastest libraries for image processing or computer vision that provide python as the front-end API? In this post, we will discuss some of the simplest image operations, and see how different libraries perform  in terms of speed. Note that we are interested in speed only, and not the actual output of the operations performed. This is because the image operations that we are using for the post are typically pre-processing step for end-applications (and evaluation metric might differ in different applications)</p>

<h2 id="1-contestants">1. Contestants</h2>

<p>We boiled down to following three most popular computer vision libraries. (Few others who didn’t make it to the list - <a href="http://www.vlfeat.org/">VLFeat</a>, <a href="http://simplecv.org/">SimpleCV</a>, <a href="http://www.simpleitk.org/">SimpleITK</a>, <a href="http://ilastik.org/">ilastik</a>)</p>

<h3 id="11-opencv">1.1 OpenCV</h3>
<p>Probably the most popular and commonly use computer vision library. It is written primarily in C++ but has bindings for Matlab, Python and Java. <strong>Pros</strong> - runs on variety of platforms (Windows/Linux/OSX, Android, iOS), fast, large active community support. <strong>Cons</strong> - lack of documentation for latest python APIs, lots of dependencies, less backward compatibility.</p>

<h3 id="12-mahotas">1.2 mahotas</h3>
<p>Again a fast library as most of its algorithms are written in C++, mahotas is optimal choice for developers from python background with its clean python interface and seemless operations with numpy arrays. <strong>Pros</strong> - large number of implemented algorithms, clean python interface, C++ backend for speed, numpy integration. <strong>Cons</strong> - smaller community</p>

<h3 id="13-skimage">1.3 skimage</h3>
<p>Most popular computer vision library amid Python users. <strong>Pros</strong> - integrates well with other python package like sklearn/scipy. <strong>Cons</strong> - fewer algorithms implemented.</p>

<h2 id="2-operations">2. operations</h2>

<p>We are going to evaulate following basic operations for image processing</p>

<ul>
  <li>read (jpeg) image file to numpy array</li>
  <li>erosion</li>
  <li>dilation</li>
  <li>open</li>
  <li>close</li>
  <li>sobel</li>
  <li>watershed</li>
</ul>

<h2 id="3-boilerplate-stuff">3. boilerplate stuff</h2>

<p>Some functions we’ll be using for plotting. Also specifying some image paths (modify them as necessary)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">cv2</span><span class="p">,</span> <span class="n">mahotas</span><span class="p">,</span> <span class="n">skimage</span><span class="p">,</span> <span class="n">skimage</span><span class="p">.</span><span class="n">morphology</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">show</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">lena_path</span> <span class="o">=</span> <span class="s">'pershoot/lena.jpeg'</span>

<span class="k">def</span> <span class="nf">pyplots</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scatter</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">]):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="erode">erode</h3>

<p>kind of making thick lines skinny</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fRGB</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">lena_path</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="n">f64</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">lena_path</span><span class="p">,</span> <span class="n">as_grey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f64</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">otsu</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">otsu</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">otsu</span><span class="p">)</span>
<span class="n">fbin</span> <span class="o">=</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="n">otsu</span>
<span class="n">fbin8</span> <span class="o">=</span> <span class="n">fbin</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">Bc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Bc</span> <span class="o">=</span> <span class="n">Bc</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">Bc8</span> <span class="o">=</span> <span class="n">Bc</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">fMH</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">erode</span><span class="p">(</span><span class="n">fbin</span><span class="p">,</span> <span class="n">Bc</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">skimage</span><span class="p">.</span><span class="n">morphology</span><span class="p">.</span><span class="n">opening</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">erode</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>

<span class="n">pyplots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fMH</span><span class="p">,</span> <span class="n">fSK</span><span class="p">,</span> <span class="n">fCV</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>93
</code></pre></div></div>

<p><img src="/images/pershoot/output_6_1.png" alt="_config.yml" /></p>

<h3 id="dilate">dilate</h3>

<p>making thin lines thicker</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fMH</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">fbin</span><span class="p">,</span> <span class="n">Bc</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">skimage</span><span class="p">.</span><span class="n">morphology</span><span class="p">.</span><span class="n">dilation</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>

<span class="n">pyplots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fMH</span><span class="p">,</span> <span class="n">fSK</span><span class="p">,</span> <span class="n">fCV</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/pershoot/output_8_0.png" alt="_config.yml" /></p>

<h3 id="open">open</h3>

<p>erosion followed by dilation; removes thin (noisy) lines/holes</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fMH</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">fbin</span><span class="p">,</span> <span class="n">Bc</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">skimage</span><span class="p">.</span><span class="n">morphology</span><span class="p">.</span><span class="n">opening</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>

<span class="n">pyplots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fMH</span><span class="p">,</span> <span class="n">fSK</span><span class="p">,</span> <span class="n">fCV</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/pershoot/output_10_0.png" alt="_config.yml" /></p>

<h3 id="close">close</h3>

<p>dilation followed by erosion; fills up small holes in the image</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fMH</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="n">fbin</span><span class="p">,</span> <span class="n">Bc</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">skimage</span><span class="p">.</span><span class="n">morphology</span><span class="p">.</span><span class="n">closing</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fbin8</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">Bc8</span><span class="p">)</span>

<span class="n">pyplots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fMH</span><span class="p">,</span> <span class="n">fSK</span><span class="p">,</span> <span class="n">fCV</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/pershoot/output_12_0.png" alt="_config.yml" /></p>

<h3 id="sobel">sobel</h3>

<p>sobel edge detection (read more <a href="https://en.wikipedia.org/wiki/Sobel_operator">here</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fMH</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">f64</span><span class="p">,</span> <span class="n">just_filter</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">skimage</span><span class="p">.</span><span class="n">filters</span><span class="p">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">f64</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">f64</span><span class="p">,</span><span class="n">cv2</span><span class="p">.</span><span class="n">CV_64F</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="mi">11</span><span class="p">))</span>

<span class="n">pyplots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fMH</span><span class="p">,</span> <span class="n">fSK</span><span class="p">,</span> <span class="n">fCV</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/pershoot/output_14_0.png" alt="_config.yml" /></p>

<h3 id="watershed">watershed</h3>

<p>background removal (read more <a href="https://en.wikipedia.org/wiki/Watershed_(image_processing)">here</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">markers</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">markers</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">markers</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">markers</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">60</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">markers</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>

<span class="c1">#fMH = mahotas.cwatershed(f, markers)
#fSK = skimage.morphology.watershed(f, markers)
#fCV = cv2.watershed(fRGB, markers)
</span>
<span class="c1">#pyplots(f, fMH, fSK, fCV, cmap='gray', scatter=True)
</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.collections.PathCollection at 0x116bb80f0&gt;
</code></pre></div></div>

<p><img src="/images/pershoot/output_16_1.png" alt="_config.yml" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">marker3d</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fRGB</span><span class="p">)</span>
<span class="n">marker3d</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">marker3d</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">20</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">marker3d</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">60</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">marker3d</span> <span class="o">=</span> <span class="n">marker3d</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>

<span class="n">marker</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">marker</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">marker</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">marker</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">60</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>

<span class="n">fMH</span> <span class="o">=</span> <span class="n">mahotas</span><span class="p">.</span><span class="n">cwatershed</span><span class="p">(</span><span class="n">fRGB</span><span class="p">,</span> <span class="n">marker3d</span><span class="p">)</span>
<span class="n">fMH</span> <span class="o">*=</span> <span class="n">otsu</span>
<span class="n">fMH</span> <span class="o">=</span> <span class="n">fMH</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">skimage</span><span class="p">.</span><span class="n">morphology</span><span class="p">.</span><span class="n">watershed</span><span class="p">(</span><span class="n">fRGB</span><span class="p">,</span> <span class="n">marker3d</span><span class="p">)</span>
<span class="n">fSK</span> <span class="o">*=</span> <span class="n">otsu</span>
<span class="n">fSK</span> <span class="o">=</span> <span class="n">fSK</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">watershed</span><span class="p">(</span><span class="n">fRGB</span><span class="p">,</span> <span class="n">marker</span><span class="p">)</span>
<span class="n">fCV</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">fCV</span> <span class="o">*=</span><span class="n">otsu</span>

<span class="n">pyplots</span><span class="p">(</span><span class="n">fRGB</span><span class="p">,</span> <span class="n">fMH</span><span class="p">,</span> <span class="n">fSK</span><span class="p">,</span> <span class="n">fCV</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'jet'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/pershoot/output_17_0.png" alt="_config.yml" /></p>

<h2 id="mahotas-vs-skimage-vs-opencv">mahotas vs skimage vs opencv</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pre</span> <span class="o">=</span><span class="s">'''
import numpy as np
import cv2, mahotas, skimage
from skimage.feature import greycomatrix, greycoprops

lena_path = 'pershoot/lena.jpeg'
fRGB = mahotas.imread(lena_path, as_grey=False)
f64 = mahotas.imread(lena_path, as_grey=True)
f = f64.astype(int)

marker3d = np.zeros_like(fRGB)
marker3d[90,100,:] = [1,1,1]
marker3d[90,20,:] = [2,2,2]
marker3d[90,60,:] = [3,3,3]
marker3d = marker3d.astype(np.int32)

marker = np.zeros_like(f)
marker[90,100] = 1
marker[90,20] = 2
marker[90,60] = 3
marker = marker.astype(np.int32)

otsu = mahotas.otsu(f.astype(np.uint8))
fbin = f &gt; otsu
fbin8 = fbin.astype(np.uint8)

Bc = np.eye(3)
Bc = Bc.astype(bool)
Bc8 = Bc.astype(np.uint8)
'''</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">t</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">timeit</span><span class="p">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">'erode'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.erode(fbin, Bc)'</span><span class="p">,</span>
        <span class="s">'skimage.morphology.opening(fbin8, Bc8)'</span><span class="p">,</span>
        <span class="s">'cv2.erode(fbin8, Bc8)'</span><span class="p">,</span>
        <span class="p">]),</span>
    <span class="p">(</span><span class="s">'dilate'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.dilate(fbin, Bc)'</span><span class="p">,</span>
        <span class="s">'skimage.morphology.dilation(fbin8, Bc8)'</span><span class="p">,</span>
        <span class="s">'cv2.dilate(fbin8, Bc8)'</span><span class="p">,</span>
        <span class="p">]),</span>
    <span class="p">(</span><span class="s">'open'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.open(fbin, Bc)'</span><span class="p">,</span>
        <span class="s">'skimage.morphology.opening(fbin8, Bc8)'</span><span class="p">,</span>
        <span class="s">'cv2.morphologyEx(fbin8, cv2.MORPH_OPEN, Bc8)'</span><span class="p">,</span>
        <span class="p">]),</span>
    <span class="p">(</span><span class="s">'close'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.close(fbin, Bc)'</span><span class="p">,</span>
        <span class="s">'skimage.morphology.closing(fbin8, Bc8)'</span><span class="p">,</span>
        <span class="s">'cv2.morphologyEx(fbin8, cv2.MORPH_CLOSE, Bc8)'</span><span class="p">,</span>
        <span class="p">]),</span>
    <span class="p">(</span><span class="s">'sobel'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.sobel(f)'</span><span class="p">,</span>
        <span class="s">'skimage.filters.sobel(f64)'</span><span class="p">,</span>
        <span class="s">'cv2.Sobel(f64,cv2.CV_64F,1,1)'</span><span class="p">,</span>
        <span class="p">]),</span>
    <span class="p">(</span><span class="s">'cwatershed'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.cwatershed(fRGB, marker3d)'</span><span class="p">,</span>
        <span class="s">'skimage.morphology.watershed(fRGB, marker3d)'</span><span class="p">,</span>
        <span class="s">'cv2.watershed(fRGB, marker)'</span><span class="p">,</span>
        <span class="p">]),</span>
    <span class="p">(</span><span class="s">'haralick'</span><span class="p">,</span> <span class="p">[</span>
        <span class="s">'mahotas.features.haralick(f)'</span><span class="p">,</span>
        <span class="s">'greycoprops(greycomatrix(f, [1], [0]))'</span><span class="p">,</span>
        <span class="bp">None</span><span class="p">,</span>
        <span class="p">]),</span>
<span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s">r'%-12s|%9s |%9s |%9s |'</span> <span class="o">%</span> <span class="p">(</span><span class="s">'Algorithm'</span><span class="p">,</span> <span class="s">'mahotas'</span><span class="p">,</span><span class="s">'skimage'</span><span class="p">,</span><span class="s">'opencv'</span><span class="p">))</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">statements</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">r'%-12s|'</span> <span class="o">%</span> <span class="n">name</span><span class="p">),</span>
    <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">st</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'      NA |'</span><span class="p">),</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="s">'%.4f'</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">st</span><span class="p">))</span>
            <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'%8s |'</span> <span class="o">%</span> <span class="n">time</span><span class="p">),</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Algorithm   |  mahotas |  skimage |   opencv |
erode       |  0.0006 |  0.0208 |  0.0003 |
dilate      |  0.0002 |  0.0096 |  0.0003 |
open        |  0.0005 |  0.0176 |  0.0005 |
close       |  0.0005 |  0.0174 |  0.0007 |
sobel       |  0.0485 |  0.0230 |  0.0022 |
cwatershed  |  0.9176 |  0.7912 |  0.0030 |
haralick    |  0.2126 |  0.0182 |      NA |
</code></pre></div></div>

<p><strong>AND we have a winner</strong></p>

<p>OpenCV outperforms mahotas and skimage (by an order of magnitude).</p>

<p>I performed a bit experimentation computing more intensive image features like haralick features and hu moments. Will share my findings in the <a href="http://kampta.github.io/Performance-Shootout-mahotas-vs-skimage-vs-opencv-part2/">next blog</a>.</p>

<p>Happy learning by coding!</p>

  </div>

  <div class="date">
    Written on May  1, 2015
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'kampta';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:kamalgupta308@gmail.com"><i class="svg-icon email"></i></a>
<a href="https://www.facebook.com/kamalgupta09"><i class="svg-icon facebook"></i></a>
<a href="https://www.flickr.com/kamalgupta09"><i class="svg-icon flickr"></i></a>
<a href="https://github.com/kampta"><i class="svg-icon github"></i></a>
<a href="https://instagram.com/kampta"><i class="svg-icon instagram"></i></a>
<a href="https://www.linkedin.com/in/kamalgupta09"><i class="svg-icon linkedin"></i></a>


<a href="https://www.twitter.com/kamalgupta09"><i class="svg-icon twitter"></i></a>
<a href="http://stackoverflow.com/users/2353472/kampta"><i class="svg-icon stackoverflow"></i></a>


        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-38633444-2', 'auto');
		ga('send', 'pageview', {
		  'page': '/Performance-Shootout-mahotas-vs-skimage-vs-opencv-part1/',
		  'title': 'Performance shootout - python libraries for computer vision (Part 1/2)'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
